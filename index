<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arlanda Express Revenue Modeler</title>
    <meta name="description" content="Interactive dashboard to model revenue, PAX, and ROI for marketing campaigns.">
    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- REACT APPLICATION -->
    <script type="module">

        import React, { useState, useMemo, useEffect } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            TrendingUp, TrendingDown, Users, DollarSign, AlertCircle, 
            Calendar, Settings, Info, PieChart, Calculator, Clock, 
            Activity, Share2, Link as LinkIcon, Check, Download, FileText, Code
        } from 'https://esm.sh/lucide-react@0.294.0?deps=react@18.2.0';

        // --- CONFIGURATION DATA ---
        const INITIAL_CHANNELS = {
            web: { id: 'web', name: 'Website', traffic: 150000, cr: 15.0, bizShare: 50, returnMix: 40, avgGroupSize: 1.2 },
            app: { id: 'app', name: 'App', traffic: 30000, cr: 50.0, bizShare: 50, returnMix: 30, avgGroupSize: 1.0 },
            kiosk: { id: 'kiosk', name: 'Kiosks', traffic: 15000, cr: 90.0, bizShare: 50, returnMix: 50, avgGroupSize: 1.5 }
        };

        const DEFAULT_TICKET_PRICES = { adult: 340, pensioner: 210, youth: 160, child: 160 };
        const DEFAULT_LEISURE_MIX = { adult: 60, pensioner: 20, youth: 10, child: 10 };

        // --- UI COMPONENTS ---
        const Card = ({ children, className = "" }) => (
            React.createElement("div", { className: `bg-white rounded-lg shadow-sm border border-gray-200 ${className}` }, children)
        );

        const SliderInput = ({ label, value, onChange, min, max, step = 1, unit = "", tooltip = "" }) => (
            React.createElement("div", { className: "mb-4" },
                React.createElement("div", { className: "flex justify-between items-center mb-1" },
                    React.createElement("label", { className: "text-xs font-medium text-gray-600 flex items-center gap-1" },
                        label,
                        tooltip && React.createElement("span", { className: "text-gray-400 cursor-help", title: tooltip }, "ⓘ")
                    ),
                    React.createElement("span", { className: "text-xs font-bold text-gray-900" }, `${value}${unit}`)
                ),
                React.createElement("input", {
                    type: "range",
                    min: min, max: max, step: step,
                    value: value,
                    onChange: (e) => onChange(parseFloat(e.target.value)),
                    className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-yellow-500"
                })
            )
        );

        const NumberInput = ({ label, value, onChange, unit = "", step = 1 }) => (
            React.createElement("div", { className: "mb-4" },
                React.createElement("label", { className: "block text-xs font-medium text-gray-600 mb-1" }, label),
                React.createElement("div", { className: "relative" },
                    React.createElement("input", {
                        type: "number",
                        value: value, step: step,
                        onChange: (e) => onChange(parseFloat(e.target.value)),
                        className: "block w-full text-right pr-8 pl-2 py-1 text-sm border-gray-300 border rounded focus:ring-yellow-500 focus:border-yellow-500"
                    }),
                    React.createElement("span", { className: "absolute right-2 top-1.5 text-xs text-gray-400" }, unit)
                )
            )
        );

        const KPIBox = ({ icon: Icon, label, value, subtext, color = "gray", tooltip }) => (
            React.createElement("div", { className: "bg-white p-4 rounded-lg border border-gray-200 shadow-sm relative group" },
                tooltip && React.createElement("div", { className: "absolute top-2 right-2 text-gray-300 cursor-help group-hover:text-gray-500", title: tooltip }, "ⓘ"),
                React.createElement("div", { className: "flex items-center gap-2 mb-2" },
                    React.createElement("div", { className: `p-1.5 rounded bg-${color}-100 text-${color}-600` },
                        React.createElement(Icon, { className: "w-4 h-4" })
                    ),
                    React.createElement("span", { className: "text-xs font-bold uppercase text-gray-500" }, label)
                ),
                React.createElement("div", { className: "text-xl font-bold text-gray-800" }, value),
                subtext && React.createElement("div", { className: "text-xs text-gray-400 mt-1" }, subtext)
            )
        );

        // --- MAIN APP COMPONENT ---
        function RevenueModeler() {
            // STATE
            const [channels, setChannels] = useState(INITIAL_CHANNELS);
            const [prices, setPrices] = useState(DEFAULT_TICKET_PRICES);
            const [leisureMix, setLeisureMix] = useState(DEFAULT_LEISURE_MIX);
            const [scenario, setScenario] = useState({
                active: true,
                name: "New Campaign",
                targetChannel: "web", 
                targetSegment: "leisure", 
                yieldImpact: 0, 
                crImpact: 0,
                trafficImpact: 0,
            });
            const [financials, setFinancials] = useState({
                investment: 500000,
                discountRate: 10,
                lifespan: 3,
            });
            
            // Share State
            const [copied, setCopied] = useState(false);

            // --- LOAD STATE FROM URL ON MOUNT ---
            useEffect(() => {
                try {
                    const hash = window.location.hash;
                    if (hash && hash.startsWith('#config=')) {
                        const jsonString = decodeURIComponent(hash.substring(8)); // remove #config=
                        const savedState = JSON.parse(jsonString);
                        
                        if(savedState.channels) setChannels(savedState.channels);
                        if(savedState.prices) setPrices(savedState.prices);
                        if(savedState.leisureMix) setLeisureMix(savedState.leisureMix);
                        if(savedState.scenario) setScenario(savedState.scenario);
                        if(savedState.financials) setFinancials(savedState.financials);
                    }
                } catch (e) {
                    console.error("Failed to load configuration from URL", e);
                }
            }, []);

            // --- SHARE FUNCTION ---
            const handleShare = () => {
                const fullState = { channels, prices, leisureMix, scenario, financials };
                const jsonString = JSON.stringify(fullState);
                const encoded = encodeURIComponent(jsonString);
                
                // Update URL without reloading
                window.location.hash = `config=${encoded}`;
                
                // Copy to clipboard
                navigator.clipboard.writeText(window.location.href).then(() => {
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                });
            };

            // --- DOWNLOAD FUNCTIONS ---
            const downloadFile = (filename, content, contentType) => {
                const blob = new Blob([content], { type: contentType });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            const handleDownloadReadme = () => {
                const content = `# Arlanda Express Revenue Modeler

## Overview
A React-based interactive dashboard for modeling revenue impact, PAX volume, and financial KPIs (ROI, NPV, IRR) for marketing campaigns.

## Features
- **Revenue & PAX Forecasting:** Model scenarios based on channel traffic, conversion rates, and ticket mix.
- **Financial KPIs:** Automatically calculates Simple ROI, Payback Period, NPV, and IRR.
- **Interactive Scenarios:** Adjust yield, conversion, and traffic impacts in real-time.
- **Shareable:** Save and share configurations via URL.

## Usage
Simply open \`index.html\` in any modern web browser. No build steps, servers, or installation required.

## Tech Stack
- **React 18:** via ESM CDN
- **Tailwind CSS:** via CDN
- **Lucide Icons:** for UI elements
`;
                downloadFile('README.md', content, 'text/markdown');
            };

            const handleDownloadHTML = () => {
                // Determine the script content. 
                // We access the script tag that is currently running this React code.
                const scriptContent = document.querySelector('script[type="module"]').innerHTML;
                
                const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arlanda Express Revenue Modeler</title>
    <meta name="description" content="Interactive dashboard to model revenue, PAX, and ROI for marketing campaigns.">
    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"><\/script>
    <!-- REACT APPLICATION -->
    <script type="module">
${scriptContent}
    <\/script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
</body>
</html>`;
                downloadFile('index.html', htmlContent, 'text/html');
            };

            // LOGIC
            const calculateYield = (mix) => {
                const total = mix.adult + mix.pensioner + mix.youth + mix.child;
                const factor = total === 0 ? 0 : 100 / total;
                return (
                    (prices.adult * (mix.adult * factor) / 100) +
                    (prices.pensioner * (mix.pensioner * factor) / 100) +
                    (prices.youth * (mix.youth * factor) / 100) +
                    (prices.child * (mix.child * factor) / 100)
                );
            };

            const yieldBiz = prices.adult;
            const yieldLei = calculateYield(leisureMix);

            const calculateChannelMetrics = (channelData, scenarioData, applyScenario = false) => {
                let { traffic, cr, bizShare, returnMix, avgGroupSize } = channelData;
                let channelYieldBiz = yieldBiz;
                let channelYieldLei = yieldLei;
                
                if (applyScenario && scenarioData.active) {
                    const isTargetChannel = scenarioData.targetChannel === 'all' || scenarioData.targetChannel === channelData.id;
                    if (isTargetChannel) {
                        const impactYield = 1 + (scenarioData.yieldImpact / 100);
                        const impactCR = 1 + (scenarioData.crImpact / 100);
                        const impactTraffic = 1 + (scenarioData.trafficImpact / 100);

                        traffic = traffic * impactTraffic;
                        
                        if (scenarioData.targetSegment === 'business' || scenarioData.targetSegment === 'both') {
                            channelYieldBiz *= impactYield;
                            const crUplift = cr * (bizShare / 100) * (impactCR - 1);
                            cr += crUplift;
                        }
                        if (scenarioData.targetSegment === 'leisure' || scenarioData.targetSegment === 'both') {
                            channelYieldLei *= impactYield;
                            const crUplift = cr * ((100 - bizShare) / 100) * (impactCR - 1);
                            cr += crUplift;
                        }
                    }
                }

                const transactions = traffic * (cr / 100);
                const totalTickets = transactions * avgGroupSize;
                const tripsPerTicket = ((100 - returnMix) / 100 * 1) + (returnMix / 100 * 2);
                const totalPax = totalTickets * tripsPerTicket;
                const ticketsBiz = totalTickets * (bizShare / 100);
                const ticketsLei = totalTickets * ((100 - bizShare) / 100);
                const revenueBiz = ticketsBiz * channelYieldBiz * tripsPerTicket;
                const revenueLei = ticketsLei * channelYieldLei * tripsPerTicket;
                
                return { transactions, totalPax, revenue: revenueBiz + revenueLei, effectiveCR: cr, effectiveTraffic: traffic };
            };

            const results = useMemo(() => {
                const baseline = { pax: 0, revenue: 0 };
                const simulated = { pax: 0, revenue: 0 };
                const channelDetails = {};

                Object.values(channels).forEach(ch => {
                    const base = calculateChannelMetrics(ch, scenario, false);
                    const sim = calculateChannelMetrics(ch, scenario, true);
                    baseline.pax += base.totalPax;
                    baseline.revenue += base.revenue;
                    simulated.pax += sim.totalPax;
                    simulated.revenue += sim.revenue;
                    channelDetails[ch.id] = { base, sim };
                });
                return { baseline, simulated, channelDetails };
            }, [channels, scenario, prices, leisureMix]);

            // FINANCIAL KPIs
            const kpiResults = useMemo(() => {
                const monthlyIncrementalRevenue = results.simulated.revenue - results.baseline.revenue;
                const annualBenefit = monthlyIncrementalRevenue * 12;
                const investment = financials.investment;
                const years = financials.lifespan;
                const rate = financials.discountRate / 100;

                const totalLifetimeBenefit = annualBenefit * years;
                const netBenefit = totalLifetimeBenefit - investment;
                const roi = investment > 0 ? (netBenefit / investment) * 100 : 0;
                const paybackYears = annualBenefit > 0 ? investment / annualBenefit : 0;
                
                let pvSum = 0;
                for (let t = 1; t <= years; t++) {
                    pvSum += annualBenefit / Math.pow(1 + rate, t);
                }
                const npv = pvSum - investment;

                let irr = 0;
                if (investment > 0 && annualBenefit > 0) {
                    let low = -0.99, high = 10.0, guess = 0;
                    for (let i = 0; i < 50; i++) {
                        guess = (low + high) / 2;
                        let npvGuess = -investment;
                        for (let t = 1; t <= years; t++) {
                            npvGuess += annualBenefit / Math.pow(1 + guess, t);
                        }
                        if (Math.abs(npvGuess) < 1) break;
                        if (npvGuess > 0) low = guess; else high = guess;
                    }
                    irr = guess * 100;
                }

                return { annualBenefit, roi, paybackYears, npv, irr };
            }, [results, financials]);

            const updateChannel = (id, field, value) => setChannels(prev => ({ ...prev, [id]: { ...prev[id], [field]: value } }));
            const updateMix = (field, value) => setLeisureMix(prev => ({ ...prev, [field]: value }));

            const fmtNum = (n) => Math.round(n).toLocaleString();
            const fmtSEK = (n) => new Intl.NumberFormat('sv-SE', { style: 'currency', currency: 'SEK', maximumFractionDigits: 0 }).format(n);
            const fmtDiff = (n) => (n > 0 ? "+" : "") + fmtNum(n);
            const fmtDiffSEK = (n) => (n > 0 ? "+" : "") + fmtSEK(n);
            const fmtPerc = (n) => n.toFixed(1) + '%';

            return (
                React.createElement("div", { className: "min-h-screen bg-gray-50 p-4 md:p-8 font-sans text-gray-800" },
                    // HEADER
                    React.createElement("div", { className: "max-w-6xl mx-auto mb-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-4" },
                        React.createElement("div", null,
                            React.createElement("h1", { className: "text-2xl font-bold text-gray-900" }, "Revenue & PAX Modelling Tool"),
                            React.createElement("p", { className: "text-sm text-gray-500" }, "Product Owner Dashboard • Arlanda Express")
                        ),
                        // ACTION BUTTONS
                        React.createElement("div", { className: "flex gap-2" },
                            React.createElement("button", { 
                                onClick: handleDownloadHTML,
                                className: "flex items-center gap-2 px-3 py-2 rounded-lg font-medium text-sm bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 transition-colors"
                            },
                                React.createElement(Code, { className: "w-4 h-4" }), "Get Code"
                            ),
                            React.createElement("button", { 
                                onClick: handleDownloadReadme,
                                className: "flex items-center gap-2 px-3 py-2 rounded-lg font-medium text-sm bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 transition-colors"
                            },
                                React.createElement(FileText, { className: "w-4 h-4" }), "Get Readme"
                            ),
                            React.createElement("button", { 
                                onClick: handleShare,
                                className: `flex items-center gap-2 px-4 py-2 rounded-lg font-bold text-sm transition-all ${copied ? 'bg-green-600 text-white' : 'bg-indigo-600 text-white hover:bg-indigo-700'}`
                            },
                                copied ? React.createElement(Check, { className: "w-4 h-4" }) : React.createElement(Share2, { className: "w-4 h-4" }),
                                copied ? "Copied!" : "Share"
                            )
                        )
                    ),
                    
                    // TICKET PRICING
                    React.createElement("div", { className: "max-w-6xl mx-auto mb-8" },
                        React.createElement(Card, null,
                            React.createElement("div", { className: "bg-indigo-900 text-white px-6 py-4 rounded-t-lg flex justify-between items-center" },
                                React.createElement("div", { className: "flex items-center gap-2" },
                                    React.createElement(PieChart, { className: "w-5 h-5" }),
                                    React.createElement("h2", { className: "font-bold" }, "Ticket Pricing & Demographics")
                                ),
                                React.createElement("div", { className: "text-xs bg-indigo-800 px-3 py-1 rounded" },
                                    "Yield Leisure: ", React.createElement("strong", null, Math.round(yieldLei), " SEK"), " / Yield Biz: ", React.createElement("strong", null, Math.round(yieldBiz), " SEK")
                                )
                            ),
                            React.createElement("div", { className: "p-6 grid grid-cols-1 md:grid-cols-2 gap-8" },
                                React.createElement("div", null,
                                    React.createElement("h3", { className: "text-xs font-bold text-gray-500 uppercase mb-4 border-b pb-2" }, "Ticket Price List (Single)"),
                                    React.createElement("div", { className: "grid grid-cols-2 gap-4" },
                                        React.createElement(NumberInput, { label: "Adult (26-65)", value: prices.adult, onChange: v => setPrices({...prices, adult: v}), unit: "kr" }),
                                        React.createElement(NumberInput, { label: "Pensioner (65+)", value: prices.pensioner, onChange: v => setPrices({...prices, pensioner: v}), unit: "kr" }),
                                        React.createElement(NumberInput, { label: "Youth (18-25)", value: prices.youth, onChange: v => setPrices({...prices, youth: v}), unit: "kr" }),
                                        React.createElement(NumberInput, { label: "Child (0-17)", value: prices.child, onChange: v => setPrices({...prices, child: v}), unit: "kr" })
                                    )
                                ),
                                React.createElement("div", null,
                                    React.createElement("h3", { className: "text-xs font-bold text-gray-500 uppercase mb-4 border-b pb-2" }, "Leisure Traveler Mix (%)"),
                                    React.createElement("div", { className: "space-y-2" },
                                        React.createElement("div", { className: "flex gap-2 text-xs" },
                                            React.createElement("div", { className: "flex-1" },
                                                React.createElement("span", { className: "block mb-1" }, "Adult"),
                                                React.createElement("input", { type: "range", className: "w-full h-1 bg-gray-200 rounded accent-indigo-600", min: 0, max: 100, value: leisureMix.adult, onChange: e => updateMix('adult', parseFloat(e.target.value)) }),
                                                React.createElement("div", { className: "text-right font-bold" }, leisureMix.adult, "%")
                                            ),
                                            React.createElement("div", { className: "flex-1" },
                                                React.createElement("span", { className: "block mb-1" }, "Pens"),
                                                React.createElement("input", { type: "range", className: "w-full h-1 bg-gray-200 rounded accent-indigo-600", min: 0, max: 100, value: leisureMix.pensioner, onChange: e => updateMix('pensioner', parseFloat(e.target.value)) }),
                                                React.createElement("div", { className: "text-right font-bold" }, leisureMix.pensioner, "%")
                                            )
                                        ),
                                        React.createElement("div", { className: "flex gap-2 text-xs" },
                                            React.createElement("div", { className: "flex-1" },
                                                React.createElement("span", { className: "block mb-1" }, "Youth"),
                                                React.createElement("input", { type: "range", className: "w-full h-1 bg-gray-200 rounded accent-indigo-600", min: 0, max: 100, value: leisureMix.youth, onChange: e => updateMix('youth', parseFloat(e.target.value)) }),
                                                React.createElement("div", { className: "text-right font-bold" }, leisureMix.youth, "%")
                                            ),
                                            React.createElement("div", { className: "flex-1" },
                                                React.createElement("span", { className: "block mb-1" }, "Child"),
                                                React.createElement("input", { type: "range", className: "w-full h-1 bg-gray-200 rounded accent-indigo-600", min: 0, max: 100, value: leisureMix.child, onChange: e => updateMix('child', parseFloat(e.target.value)) }),
                                                React.createElement("div", { className: "text-right font-bold" }, leisureMix.child, "%")
                                            )
                                        ),
                                        React.createElement("div", { className: "text-xs text-gray-400 pt-2 italic text-center" },
                                            `Total: ${leisureMix.adult + leisureMix.pensioner + leisureMix.youth + leisureMix.child}% (Values normalized if != 100)`
                                        )
                                    )
                                )
                            )
                        )
                    ),

                    // SCENARIO & FINANCIAL CONFIG
                    React.createElement("div", { className: "max-w-6xl mx-auto mb-8 grid grid-cols-1 md:grid-cols-3 gap-6" },
                        React.createElement("div", { className: "md:col-span-2" },
                            React.createElement(Card, { className: "border-l-4 border-l-yellow-400 overflow-hidden h-full" },
                                React.createElement("div", { className: "bg-yellow-50 px-6 py-4 border-b border-yellow-100 flex justify-between items-center" },
                                    React.createElement("div", { className: "flex items-center gap-2" },
                                        React.createElement(Settings, { className: "w-5 h-5 text-yellow-600" }),
                                        React.createElement("h2", { className: "font-bold text-yellow-800" }, "Scenario Assumptions")
                                    ),
                                    React.createElement("div", { className: "flex items-center gap-2" },
                                        React.createElement("label", { className: "text-sm font-medium text-yellow-800" }, "Active"),
                                        React.createElement("input", { type: "checkbox", checked: scenario.active, onChange: e => setScenario({...scenario, active: e.target.checked}), className: "w-4 h-4 accent-yellow-500" })
                                    )
                                ),
                                React.createElement("div", { className: "p-6 space-y-6" },
                                    React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                                        React.createElement("div", null,
                                            React.createElement("label", { className: "block text-xs font-bold text-gray-500 uppercase mb-1" }, "Campaign/Feature Name"),
                                            React.createElement("input", { type: "text", value: scenario.name, onChange: e => setScenario({...scenario, name: e.target.value}), className: "w-full border border-gray-300 rounded p-2 text-sm" })
                                        ),
                                        React.createElement("div", { className: "grid grid-cols-2 gap-2" },
                                            React.createElement("div", null,
                                                React.createElement("label", { className: "block text-xs font-bold text-gray-500 uppercase mb-1" }, "Channel Scope"),
                                                React.createElement("select", { value: scenario.targetChannel, onChange: e => setScenario({...scenario, targetChannel: e.target.value}), className: "w-full border border-gray-300 rounded p-2 text-sm" },
                                                    React.createElement("option", { value: "all" }, "All Channels"),
                                                    React.createElement("option", { value: "web" }, "Website"),
                                                    React.createElement("option", { value: "app" }, "App"),
                                                    React.createElement("option", { value: "kiosk" }, "Kiosks")
                                                )
                                            ),
                                            React.createElement("div", null,
                                                React.createElement("label", { className: "block text-xs font-bold text-gray-500 uppercase mb-1" }, "Segment Scope"),
                                                React.createElement("select", { value: scenario.targetSegment, onChange: e => setScenario({...scenario, targetSegment: e.target.value}), className: "w-full border border-gray-300 rounded p-2 text-sm" },
                                                    React.createElement("option", { value: "both" }, "All Users"),
                                                    React.createElement("option", { value: "leisure" }, "Leisure"),
                                                    React.createElement("option", { value: "business" }, "Business")
                                                )
                                            )
                                        )
                                    ),
                                    React.createElement("div", { className: "bg-gray-50 rounded-lg p-4 border border-gray-100" },
                                        React.createElement("h3", { className: "text-sm font-bold text-gray-700 mb-3" }, "Impact Levers (vs Baseline)"),
                                        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-8" },
                                            React.createElement("div", null,
                                                React.createElement(SliderInput, { label: "Yield (Price)", value: scenario.yieldImpact, onChange: v => setScenario({...scenario, yieldImpact: v}), min: -50, max: 50, step: 1, unit: "%", tooltip: "Impact on average ticket price/yield." })
                                            ),
                                            React.createElement("div", null,
                                                React.createElement(SliderInput, { label: "Conversion Rate", value: scenario.crImpact, onChange: v => setScenario({...scenario, crImpact: v}), min: -50, max: 100, step: 1, unit: "%", tooltip: "Impact on purchase conversion." })
                                            ),
                                            React.createElement("div", null,
                                                React.createElement(SliderInput, { label: "Traffic Volume", value: scenario.trafficImpact, onChange: v => setScenario({...scenario, trafficImpact: v}), min: -50, max: 100, step: 1, unit: "%", tooltip: "Impact on visitor numbers." })
                                            )
                                        )
                                    )
                                )
                            )
                        ),
                        React.createElement("div", { className: "md:col-span-1" },
                            React.createElement(Card, { className: "h-full border-l-4 border-l-green-500" },
                                React.createElement("div", { className: "bg-green-50 px-6 py-4 border-b border-green-100" },
                                    React.createElement("div", { className: "flex items-center gap-2" },
                                        React.createElement(DollarSign, { className: "w-5 h-5 text-green-700" }),
                                        React.createElement("h2", { className: "font-bold text-green-800" }, "Financial Params")
                                    )
                                ),
                                React.createElement("div", { className: "p-6 space-y-4" },
                                    React.createElement("div", null,
                                        React.createElement(NumberInput, { label: "Investment Cost (SEK)", value: financials.investment, step: 10000, onChange: v => setFinancials({...financials, investment: v}), unit: "kr" }),
                                        React.createElement("p", { className: "text-xs text-gray-400 mt-1" }, "Total project/campaign cost.")
                                    ),
                                    React.createElement("div", null,
                                        React.createElement(SliderInput, { label: "Project Lifespan", value: financials.lifespan, onChange: v => setFinancials({...financials, lifespan: v}), min: 1, max: 5, step: 1, unit: " Years", tooltip: "Duration for NPV/ROI calculation." })
                                    ),
                                    React.createElement("div", null,
                                        React.createElement(SliderInput, { label: "Discount Rate (WACC)", value: financials.discountRate, onChange: v => setFinancials({...financials, discountRate: v}), min: 0, max: 20, step: 0.5, unit: "%", tooltip: "Required rate of return for NPV." })
                                    ),
                                    React.createElement("div", { className: "pt-4 border-t border-gray-100" },
                                        React.createElement("div", { className: "text-xs text-gray-500 flex justify-between" },
                                            React.createElement("span", null, "Annual Lift (Est):"),
                                            React.createElement("span", { className: "font-bold" }, fmtSEK(kpiResults.annualBenefit))
                                        )
                                    )
                                )
                            )
                        )
                    ),

                    // FINANCIAL KPIs
                    React.createElement("div", { className: "max-w-6xl mx-auto mb-8" },
                        React.createElement("h3", { className: "text-lg font-bold text-gray-800 mb-4 flex items-center gap-2" },
                            React.createElement(Activity, { className: "w-5 h-5" }),
                            "Financial Performance KPIs"
                        ),
                        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-4 gap-4" },
                            React.createElement(KPIBox, { 
                                icon: TrendingUp, label: "ROI (Simple)", value: fmtPerc(kpiResults.roi), 
                                subtext: `${financials.lifespan} Year Return`, color: kpiResults.roi > 0 ? "green" : "red",
                                tooltip: "(Net Benefit / Investment) × 100"
                            }),
                            React.createElement(KPIBox, { 
                                icon: Clock, label: "Payback Period", 
                                value: kpiResults.paybackYears < 0.1 ? "Immediate" : kpiResults.paybackYears > financials.lifespan ? "> Lifespan" : `${kpiResults.paybackYears.toFixed(1)} Years`, 
                                subtext: `(${(kpiResults.paybackYears * 12).toFixed(0)} Months)`, color: "blue",
                                tooltip: "Investment / Annual Benefit"
                            }),
                            React.createElement(KPIBox, { 
                                icon: DollarSign, label: "NPV", value: fmtSEK(kpiResults.npv), 
                                subtext: `${financials.lifespan} Yr @ ${financials.discountRate}% Rate`, color: kpiResults.npv > 0 ? "green" : "red",
                                tooltip: "Net Present Value of future cash flows"
                            }),
                            React.createElement(KPIBox, { 
                                icon: Calculator, label: "IRR", value: fmtPerc(kpiResults.irr), 
                                subtext: "Internal Rate of Return", color: kpiResults.irr > financials.discountRate ? "green" : "orange",
                                tooltip: "Annualized return rate where NPV = 0"
                            })
                        )
                    ),

                    // IMPACT DASHBOARD (Revenue & PAX)
                    React.createElement("div", { className: "max-w-6xl mx-auto mb-8" },
                        React.createElement("h3", { className: "text-lg font-bold text-gray-800 mb-4 flex items-center gap-2" },
                            React.createElement(Calendar, { className: "w-5 h-5" }),
                            "Operational Impact (vs Baseline)"
                        ),
                        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
                            React.createElement(Card, { className: "p-5" },
                                React.createElement("div", { className: "text-xs font-bold text-gray-400 uppercase mb-4" }, "1 Week Horizon"),
                                React.createElement("div", { className: "space-y-3" },
                                    React.createElement("div", { className: "flex justify-between items-end" },
                                        React.createElement("span", { className: "text-sm text-gray-600" }, "PAX"),
                                        React.createElement("div", { className: `text-lg font-bold ${(results.simulated.pax - results.baseline.pax) >= 0 ? 'text-green-600' : 'text-red-600'}` }, fmtDiff((results.simulated.pax - results.baseline.pax) * 0.25))
                                    ),
                                    React.createElement("div", { className: "flex justify-between items-end" },
                                        React.createElement("span", { className: "text-sm text-gray-600" }, "Revenue"),
                                        React.createElement("div", { className: `text-lg font-bold ${(results.simulated.revenue - results.baseline.revenue) >= 0 ? 'text-green-600' : 'text-red-600'}` }, fmtDiffSEK((results.simulated.revenue - results.baseline.revenue) * 0.25))
                                    )
                                )
                            ),
                            React.createElement(Card, { className: "p-5 ring-2 ring-yellow-400 ring-opacity-50" },
                                React.createElement("div", { className: "flex justify-between items-start mb-4" },
                                    React.createElement("div", { className: "text-xs font-bold text-gray-400 uppercase" }, "1 Month Horizon"),
                                    React.createElement("span", { className: "bg-yellow-100 text-yellow-800 text-xs font-bold px-2 py-0.5 rounded" }, "Primary View")
                                ),
                                React.createElement("div", { className: "space-y-3" },
                                    React.createElement("div", { className: "flex justify-between items-end border-b border-dashed border-gray-200 pb-2" },
                                        React.createElement("span", { className: "text-sm text-gray-600" }, "PAX Volume"),
                                        React.createElement("div", { className: "text-right" },
                                            React.createElement("span", { className: "text-xs text-gray-400 block" }, fmtNum(results.simulated.pax), " Total"),
                                            React.createElement("span", { className: `text-xl font-bold ${(results.simulated.pax - results.baseline.pax) >= 0 ? 'text-green-600' : 'text-red-600'}` }, fmtDiff(results.simulated.pax - results.baseline.pax))
                                        )
                                    ),
                                    React.createElement("div", { className: "flex justify-between items-end" },
                                        React.createElement("span", { className: "text-sm text-gray-600" }, "Revenue"),
                                        React.createElement("div", { className: "text-right" },
                                            React.createElement("span", { className: "text-xs text-gray-400 block" }, fmtSEK(results.simulated.revenue), " Total"),
                                            React.createElement("span", { className: `text-xl font-bold ${(results.simulated.revenue - results.baseline.revenue) >= 0 ? 'text-green-600' : 'text-red-600'}` }, fmtDiffSEK(results.simulated.revenue - results.baseline.revenue))
                                        )
                                    )
                                )
                            ),
                            React.createElement(Card, { className: "p-5" },
                                React.createElement("div", { className: "text-xs font-bold text-gray-400 uppercase mb-4" }, "12 Months Horizon"),
                                React.createElement("div", { className: "space-y-3" },
                                    React.createElement("div", { className: "flex justify-between items-end" },
                                        React.createElement("span", { className: "text-sm text-gray-600" }, "PAX"),
                                        React.createElement("div", { className: `text-lg font-bold ${(results.simulated.pax - results.baseline.pax) >= 0 ? 'text-green-600' : 'text-red-600'}` }, fmtDiff((results.simulated.pax - results.baseline.pax) * 12))
                                    ),
                                    React.createElement("div", { className: "flex justify-between items-end" },
                                        React.createElement("span", { className: "text-sm text-gray-600" }, "Revenue"),
                                        React.createElement("div", { className: `text-lg font-bold ${(results.simulated.revenue - results.baseline.revenue) >= 0 ? 'text-green-600' : 'text-red-600'}` }, fmtDiffSEK((results.simulated.revenue - results.baseline.revenue) * 12))
                                    )
                                )
                            )
                        )
                    ),
                    
                    // CHANNELS
                    React.createElement("div", { className: "max-w-6xl mx-auto" },
                        React.createElement("h3", { className: "text-lg font-bold text-gray-800 mb-4 flex items-center gap-2" },
                            React.createElement(Settings, { className: "w-5 h-5" }),
                            "Channel Baselines (Monthly)"
                        ),
                        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-6" },
                            Object.values(channels).map(channel => {
                                const metrics = results.channelDetails[channel.id];
                                const isImpacted = scenario.active && (scenario.targetChannel === 'all' || scenario.targetChannel === channel.id);
                                return React.createElement(Card, { key: channel.id, className: `overflow-hidden ${isImpacted ? 'ring-1 ring-yellow-400' : ''}` },
                                    React.createElement("div", { className: `px-4 py-3 border-b flex justify-between items-center ${channel.id === 'web' ? 'bg-gray-800 text-white' : channel.id === 'app' ? 'bg-gray-600 text-white' : 'bg-gray-400 text-white'}` },
                                        React.createElement("span", { className: "font-bold" }, channel.name),
                                        isImpacted && React.createElement("span", { className: "text-xs bg-yellow-400 text-black px-2 py-0.5 rounded font-bold" }, "Active Target")
                                    ),
                                    React.createElement("div", { className: "p-4 space-y-6" },
                                        React.createElement("div", null,
                                            React.createElement("h4", { className: "text-xs font-bold text-gray-400 uppercase mb-3 border-b pb-1" }, "Traffic & Conversion"),
                                            React.createElement(NumberInput, { label: "Monthly Traffic", value: channel.traffic, onChange: v => updateChannel(channel.id, 'traffic', v) }),
                                            isImpacted && metrics.sim.effectiveTraffic !== channel.traffic && 
                                                React.createElement("div", { className: "mb-3 text-right" },
                                                    React.createElement("span", { className: "text-xs text-gray-500 mr-1" }, "Simulated Traffic:"),
                                                    React.createElement("span", { className: `text-xs font-bold ${metrics.sim.effectiveTraffic > channel.traffic ? 'text-green-600' : 'text-red-600'}` }, 
                                                        `${fmtNum(metrics.sim.effectiveTraffic)} (${fmtDiff(metrics.sim.effectiveTraffic - channel.traffic)})`
                                                    )
                                                ),
                                            React.createElement("div", { className: "flex gap-4" },
                                                React.createElement("div", { className: "flex-1" },
                                                    React.createElement(NumberInput, { label: "Baseline CR (%)", value: channel.cr, onChange: v => updateChannel(channel.id, 'cr', v) })
                                                ),
                                                React.createElement("div", { className: "flex-1 pt-6" },
                                                    isImpacted && metrics.sim.effectiveCR !== metrics.base.effectiveCR && 
                                                    React.createElement("div", { className: "text-xs font-bold text-blue-600 bg-blue-50 p-1 rounded text-center" }, `Scenario: ${metrics.sim.effectiveCR.toFixed(1)}%`)
                                                )
                                            )
                                        ),
                                        React.createElement("div", null,
                                            React.createElement("h4", { className: "text-xs font-bold text-gray-400 uppercase mb-3 border-b pb-1" }, "Segmentation"),
                                            React.createElement(SliderInput, { label: "Business / Leisure Split", value: channel.bizShare, onChange: v => updateChannel(channel.id, 'bizShare', v), min: 0, max: 100, unit: "%", tooltip: `${channel.bizShare}% Business, ${100-channel.bizShare}% Leisure` }),
                                            React.createElement("div", { className: "grid grid-cols-2 gap-2 text-xs text-center mb-4" },
                                                React.createElement("div", { className: "bg-slate-100 p-1 rounded" }, `Biz: ${channel.bizShare}%`),
                                                React.createElement("div", { className: "bg-orange-50 p-1 rounded" }, `Lei: ${100-channel.bizShare}%`)
                                            )
                                        ),
                                        React.createElement("div", null,
                                            React.createElement("h4", { className: "text-xs font-bold text-gray-400 uppercase mb-3 border-b pb-1" }, "Purchase Behavior"),
                                            React.createElement(SliderInput, { label: "% Buying Return Ticket", value: channel.returnMix, onChange: v => updateChannel(channel.id, 'returnMix', v), min: 0, max: 100, unit: "%" }),
                                            React.createElement(SliderInput, { label: "Avg Travelers/Trans", value: channel.avgGroupSize, onChange: v => updateChannel(channel.id, 'avgGroupSize', v), min: 1.0, max: 4.0, step: 0.1 })
                                        ),
                                        React.createElement("div", { className: "bg-gray-50 p-3 rounded border border-gray-200 space-y-1" },
                                            React.createElement("div", { className: "flex justify-between text-sm" },
                                                React.createElement("span", { className: "text-gray-500" }, "Est. PAX:"),
                                                React.createElement("span", { className: "font-bold" },
                                                    fmtNum(metrics.sim.totalPax),
                                                    isImpacted && metrics.sim.totalPax !== metrics.base.totalPax &&
                                                    React.createElement("span", { className: `ml-1 text-xs ${metrics.sim.totalPax > metrics.base.totalPax ? 'text-green-600' : 'text-red-600'}` }, `(${fmtDiff(metrics.sim.totalPax - metrics.base.totalPax)})`)
                                                )
                                            ),
                                            React.createElement("div", { className: "flex justify-between text-sm" },
                                                React.createElement("span", { className: "text-gray-500" }, "Est. Rev:"),
                                                React.createElement("span", { className: "font-bold" },
                                                    fmtSEK(metrics.sim.revenue),
                                                    isImpacted && metrics.sim.revenue !== metrics.base.revenue &&
                                                    React.createElement("span", { className: `ml-1 text-xs ${metrics.sim.revenue > metrics.base.revenue ? 'text-green-600' : 'text-red-600'}` }, `(${fmtDiff(metrics.sim.revenue - metrics.base.revenue)})`)
                                                )
                                            )
                                        )
                                    )
                                );
                            })
                        )
                    ),
                    
                    // LOGIC FOOTER
                    React.createElement("div", { className: "max-w-6xl mx-auto mt-12 pt-6 border-t border-gray-200 text-sm text-gray-500" },
                        React.createElement("h4", { className: "font-bold text-gray-700 mb-2 flex items-center gap-2" },
                            React.createElement(Info, { className: "w-4 h-4" }), "Calculation Logic"
                        ),
                        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-8" },
                            React.createElement("div", null,
                                React.createElement("h5", { className: "font-bold mb-1 text-xs uppercase text-gray-400" }, "Operational"),
                                React.createElement("p", { className: "mb-2" }, React.createElement("strong", { className: "text-gray-700" }, "Yield: "), "Weighted avg price based on demographics."),
                                React.createElement("p", null, React.createElement("strong", { className: "text-gray-700" }, "PAX Formula: "), "Transactions × Avg Travelers × (Return Mix Factor)")
                            ),
                            React.createElement("div", null,
                                React.createElement("h5", { className: "font-bold mb-1 text-xs uppercase text-gray-400" }, "Financial"),
                                React.createElement("p", { className: "mb-1" }, React.createElement("strong", { className: "text-gray-700" }, "ROI: "), "((Annual Benefit × Lifespan) - Investment) / Investment"),
                                React.createElement("p", { className: "mb-1" }, React.createElement("strong", { className: "text-gray-700" }, "NPV: "), "Sum of future cash flows discounted by WACC rate.")
                            )
                        )
                    )
                )
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(RevenueModeler));
    
    </script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
</body>
</html>
